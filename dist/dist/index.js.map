{"version":3,"sources":["../index.js"],"names":["_request","require","_request2","_interopRequireDefault","_xml2js","_freeMobileSmsApi","_freeMobileSmsApi2","obj","__esModule","default","MY_ID","process","env","MY_PRIVATE_KEY","_enableSMS","account","_enableSMS2","checkArgument","argv","length","getRssUrl","scrapeRSS","url","cb","method","err","res","body","e","console","error","parseRSS","string","parseString","result","rss","channel","LastBuild","Date","knownItems","findNewEntry","currentBuild","lastBuildDate","getTime","i","item","indexOf","guid","_","push","onNewEntry","log","enableSMS","link","author","pubDate","send","encodeURIComponent","JSON","stringify","RSS","setInterval","rssObj"],"mappings":"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","file":"index.js","sourcesContent":["'use strict';\n\nvar _request = require('request');\n\nvar _request2 = _interopRequireDefault(_request);\n\nvar _xml2js = require('xml2js');\n\nvar _freeMobileSmsApi = require('free-mobile-sms-api');\n\nvar _freeMobileSmsApi2 = _interopRequireDefault(_freeMobileSmsApi);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar MY_ID = process.env.MY_ID; /**\n                                * Created by lunik on 26/06/2017.\n                                */\n\nvar MY_PRIVATE_KEY = process.env.MY_PRIVATE_KEY;\n\nif (MY_ID && MY_PRIVATE_KEY) {\n  var _enableSMS = true;\n  _freeMobileSmsApi2.default.account(MY_ID, MY_PRIVATE_KEY);\n} else {\n  var _enableSMS2 = false;\n}\n\nfunction checkArgument() {\n  if (process.argv.length <= 2) {\n    if (typeof process.argv[2] === 'undefined') {\n      throw 'Missing rss url. \\nUsage: node dist/index.js <RSS_URL>\\n';\n    }\n  }\n}\n\nfunction getRssUrl() {\n  return process.argv[2];\n}\n\nfunction scrapeRSS(url, cb) {\n  (0, _request2.default)({\n    method: 'GET',\n    url: url\n  }, function (err, res, body) {\n    if (err) {\n      throw err;\n    }\n    try {\n      cb(body);\n    } catch (e) {\n      console.error(e);\n    }\n  });\n}\n\nfunction parseRSS(string, cb) {\n  (0, _xml2js.parseString)(string, function (err, result) {\n    if (err) {\n      throw err;\n    }\n    cb(result.rss.channel[0]);\n  });\n}\n\nvar LastBuild = new Date('1/1/1900');\nvar knownItems = [];\nfunction findNewEntry(rss, cb) {\n  var currentBuild = new Date(rss.lastBuildDate[0]);\n  if (currentBuild.getTime() > LastBuild.getTime()) {\n    LastBuild = currentBuild;\n\n    for (var i = 0; i < rss.item.length; i++) {\n      var item = rss.item[i];\n      if (knownItems.indexOf(item.guid[0]._) === -1) {\n        knownItems.push(item.guid[0]._);\n        cb(item);\n      }\n    }\n  }\n}\n\nfunction onNewEntry(item) {\n  console.log(item);\n  if (enableSMS) {\n    delete item.link;\n    delete item.guid;\n    delete item.author;\n    delete item.pubDate;\n    _freeMobileSmsApi2.default.send(encodeURIComponent(JSON.stringify(item)));\n  }\n}\n\ncheckArgument();\nvar RSS = getRssUrl();\n\nsetInterval(function () {\n  scrapeRSS(RSS, function (body) {\n    return parseRSS(body, function (rssObj) {\n      return findNewEntry(rssObj, function (item) {\n        return onNewEntry(item);\n      });\n    });\n  });\n}, 30000);"]}